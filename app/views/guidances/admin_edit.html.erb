<%= stylesheet_link_tag "admin" %>
<% javascript 'admin.js' %>

<h1>
	<%= t('org_admin.guidance_label') %>
	<!-- link button to add new guidance -->
	<div class="move_2_right">
		<%= link_to t("org_admin.guidance.add_guidance"),
		            admin_new_guidance_path(),
		            :class => 'btn btn-primary' %>
		<%= link_to t("org_admin.guidance.view_all_guidance"),
		            admin_index_guidance_path,
		            :class => 'btn btn-primary' %>
	</div>            
</h1>

<div class="div_clear"></div>

<div class="white_background blue_border">
	<!-- body -->
	<div class="dmp_details">
		<%= form_for(@guidance, :url => admin_update_guidance_path(@guidance), :html => { :method => :put}) do |f| %>
			
				<table class="dmp_details_table">
					<tr>
						<td class="first"><%= t('org_admin.guidance.text_label') %></td>
						<td><%= text_area_tag("guidance-text", @guidance.text, class: "tinymce") %></td>
					</tr>
					<tr>
						<td class="first"><%= t('org_admin.guidance.by_theme_or_by_question') %></td>
						<td><% if !@guidance.question_id.nil? then %>
								<% select_op = 2 %>
							<% else%>
								<% select_op = 1%>
							<%end%>
							<%= hidden_field 'select_op' , :value => select_op,  :id => 'edit_guid_ques_flag' %>
							
							<%= select_tag "g_options", options_for_select({t('org_admin.guidance.by_themes_label') => 1, 
								t('org_admin.guidance.by_question_label') => 2}, select_op) %>
							
							<div class="guindance_by_theme" style="display:none;"> 
								<%= f.collection_select(:theme_ids,
									Theme.find(:all, :order => 'title ASC'),
									:id, :title, {:prompt => false, :include_blank => 'None'}, {:multiple => true})%>
							</div>	
							<div class="guindace_by_question" style="display:none;">
								<% if !@guidance.question_id.nil? then %>
									<% dmp_template_id = @guidance.question.section.version.phase.dmptemplate_id %>
									<% phase_id = @guidance.question.section.version.phase_id %>
									<% version_id = @guidance.question.section.version_id %>
									<% section_id = @guidance.question.section_id %>
									<%= collection_select(:phase, :dmptemplate_id,  Dmptemplate.find(:all, :order => 'title ASC'), :id, :title, {:prompt   => "Select a template", :selected =>  dmp_template_id}, {:id => 'templates_select'}) %>
									<br/>
									<%= collection_select(:version, :phase_id, Phase.where("dmptemplate_id = ?", dmp_template_id).order('title ASC'), :id, :title, {:prompt => "Select a phase", :selected =>  phase_id}, {:id => 'phases_select'}) %>
									<br/>
									<%= collection_select(:section, :version_id, Version.where("phase_id = ?", phase_id).order('title ASC'), :id, :title, {:prompt   => "Select a version" , :selected =>  version_id}, {:id => 'versions_select'}) %>
	 								<br/>
									<%= collection_select(:question, :section_id, Section.where("version_id = ?", version_id).order('title ASC'), :id, :title, {:prompt   => "Select a section", :selected =>  section_id }, {:id => 'sections_select'}) %>
									<br/>
									<%= collection_select(:guidance, :question_id, Question.where("section_id = ?", section_id).order('text ASC'), :id, :text, {:prompt   => "Select a question"}, {:id => 'questions_select'}) %>
	 							<%else%>
	 								<%= collection_select(nil, :dmptemplate_id,  @dmptemplates, :id, :title, {:prompt   => "Select a template"}, {:id => 'templates_select'}) %>
									<br/>
									<%= collection_select(nil, :phase_id, @phases, :id, :title, {:prompt   => "Select a phase"}, {:id => 'phases_select'}) %>
									<br/>
									<%= collection_select(nil, :version_id, @versions, :id, :title, {:prompt   => "Select a version"}, {:id => 'versions_select'}) %>
	 								<br/>
									<%= collection_select(nil, :section_id, @sections, :id, :title, {:prompt   => "Select a section"}, {:id => 'sections_select'}) %>
									<br/>
									<%= collection_select(nil, :question_id, @questions, :id, :text, {:prompt   => "Select a question"}, {:id => 'questions_select'}) %>
	  							<%end%>
							</div>	
						</td>
					
					</tr>
					<tr>
						<td class="first"><%= t('org_admin.guidance.guidance_group_label') %></td>
						<td><%= f.collection_select(:guidance_group_ids,
								GuidanceGroup.where("organisation_id = ?", current_user.organisation_id).order('name ASC'),
								:id, :name, {:prompt => false, :include_blank => 'None'}, {:multiple => false})%>
						</td>
					</tr>
					
				</table>
			
			<!-- submit buttons -->
			
				<div class="move_2_right">
					<%= f.submit t('helpers.submit.save'), :class => 'btn btn-primary' %>
					<%= link_to t('helpers.submit.cancel'), :back, :class => 'btn btn-primary' %>
				</div>
			
			<br />
			<%= tinymce :content_css => asset_path('application.css') %>
		<%end%>
	</div>
</div>	
